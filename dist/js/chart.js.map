{"version":3,"names":[],"mappings":"","sources":["chart.js"],"sourcesContent":["window.d3 = require('d3');\nrequire('./vendor/sankey');\n\nvar container = document.querySelector(\"#step-flow-container\");\nwindow.margin = {top: 1, right: 1, bottom: 6, left: 1};\nwindow.width = container.clientWidth - margin.left - margin.right,\nwindow.height = 300 - margin.top - margin.bottom;\nwindow.levels = 17;\nwindow.segmentWidth = container.clientWidth / 8;\nwindow.segmentHeight = 20;\n\nvar formatNumber = d3.format(\",.0f\"),\n    format = function(d) { return formatNumber(d) + \" TWh\"; },\n    color = d3.scale.category20();\n\nvar svg = null,\n    sankey = null;\n\nvar energy = {\n    \"nodes\":[\n        {\"name\":\"\", \"step\": 0 , \"level\": 8},\n        {\"name\":\"郵寄\", \"step\": 1 , \"level\": 4},\n        {\"name\":\"臨櫃人員\", \"step\": 2, \"level\": 10},\n        {\"name\":\"\", \"step\": 5, \"level\": 10},\n        {\"name\":\"臨櫃人員\", \"step\": 6, \"level\": 6},\n        {\"name\":\"電腦\", \"step\": 2, \"level\": 3},\n        {\"name\":\"電腦\", \"step\": 3, \"level\": 0},\n        {\"name\":\"電腦\", \"step\": 4, \"level\": 1},\n        {\"name\":\"電腦\", \"step\": 5, \"level\": 2},\n        {\"name\":\"印表機\", \"step\": 6, \"level\": 8},\n        {\"name\":\"郵寄\", \"step\": 7, \"level\": 8},\n        {\"name\":\"客服\", \"step\": 5, \"level\": 6},\n        {\"name\":\"超商\", \"step\": 5, \"level\": 4}\n    ],\n    \"links\": [\n        {\"source\": 0, \"target\":1, \"value\": 0.1},\n        {\"source\": 1, \"target\":2, \"value\": 0.1},\n        {\"source\": 2, \"target\":3, \"value\": 0.1},\n        {\"source\": 3, \"target\":4, \"value\": 0.1},\n        {\"source\": 1, \"target\":5, \"value\": 0.1},\n        {\"source\": 5, \"target\":6, \"value\": 0.1},\n        {\"source\": 6, \"target\":7, \"value\": 0.1},\n        {\"source\": 7, \"target\":8, \"value\": 0.1},\n        {\"source\": 8, \"target\":9, \"value\": 0.1},\n        {\"source\": 9, \"target\":10, \"value\": 0.1},\n        {\"source\": 1, \"target\":11, \"value\": 0.1},\n        {\"source\": 1, \"target\":12, \"value\": 0.1}\n    ]\n};\n\nfunction drawSvg(id) {\n    if( svg)\n        d3.select(\"svg\").remove();\n\n    svg = d3.select(id).append(\"svg\").attr(\"width\", width)\n        .attr(\"height\", height)\n        .append(\"g\")\n        .attr(\"transform\", \"translate(\" + (window.segmentWidth / 2) + \",\" + -90 + \")\")\n\n    sankey = d3.sankey()\n        .nodeWidth(15)\n        .nodePadding(10)\n        .size([width, height]);\n\n    var path = sankey.link();\n\n    sankey\n        .nodes(energy.nodes)\n        .links(energy.links)\n        .layout(1);\n\n    var link = svg.append(\"g\").selectAll(\".link\")\n        .data(energy.links)\n        .enter().append(\"path\")\n        .attr(\"class\", \"link\")\n        .attr(\"d\", path)\n        .style(\"stroke-width\", function(d) { return 1; })\n        .style(\"stroke-dashoffset\", function(d) { return 5; })\n        .style(\"stroke-dasharray\", function(d) { return 3; })\n        .sort(function(a, b) { return b.dy - a.dy; });\n\n    link.append(\"title\")\n        .text(function(d) { return d.source.name + \" → \" + d.target.name + \"\\n\" + format(d.value); });\n\n    var node = svg.append(\"g\").selectAll(\".node\")\n        .data(energy.nodes)\n        .enter().append(\"g\")\n        .attr(\"class\", \"node\")\n        .attr(\"transform\", function(d) { \n            return \"translate(\" + (d.step * segmentWidth) + \",\" + ((levels - d.level) * segmentHeight) + \")\"; \n        }).on(\"click\", function(d){ \n            alert(d.name);\n        });\n\n    node.append(\"circle\")\n        // .attr(\"height\", function(d) { return d.dy; })\n        // .attr(\"width\", sankey.nodeWidth())\n        .attr(\"cx\", function(d) { return 5; })\n        .attr(\"cy\", function(d) { return 0; })\n        .attr(\"r\", function(d) { return 5; })\n        .style(\"fill\", function(d) { return d.color = color(d.name.replace(/ .*/, \"\")); })\n        .style(\"stroke\", function(d) { return d3.rgb(d.color).darker(2); })\n        .append(\"title\")\n        .text(function(d) { return d.name + \"\\n\" + format(d.value); });\n\n    node.append(\"text\")\n        .attr(\"x\", -6)\n        .attr(\"y\", function(d) { return 0; })\n        .attr(\"dy\", \".35em\")\n        .attr(\"text-anchor\", \"end\")\n        .attr(\"transform\", null)\n        .text(function(d) { return d.name; })\n        .filter(function(d) { return d.x < width / 2; })\n        .attr(\"x\", 6 + sankey.nodeWidth())\n        .attr(\"text-anchor\", \"start\");\n}\n\ndrawSvg(\"#step-flow-container\");\ndrawSvg(\"#step-flow-container-mobile\");\n\nwindow.onresize =  function() {\n    window.width = container.clientWidth - margin.left - margin.right;\n    window.segmentWidth = container.clientWidth / 8;\n    \n    drawSvg(\"#step-flow-container\");\n}"],"file":"chart.js"}