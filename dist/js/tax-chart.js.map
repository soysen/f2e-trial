{"version":3,"names":[],"mappings":"","sources":["tax-chart.js"],"sourcesContent":["var Highcharts = require('highcharts');\n// Load module after Highcharts is loaded\nrequire('highcharts/modules/exporting')(Highcharts);\n\n$.get('../csv/tax-comment.csv', function (r) {\n    var data = r.split(/\\r\\n/g);\n    data.forEach((item, idx) => {\n        data[idx] = item.split(/,/g);\n    });\n\n    renderDateChart(data);\n});\n\nfunction renderDateChart(data) {\n    var array_by_date = {},\n        comment = [0, 0],\n        byRole = {\n            begin: [0, 0, 0, 0],\n            pro: [0, 0, 0, 0]\n        },\n        categories = [],\n        series = [];\n    data.forEach(item => {\n        var dt = item[0].split(' ');\n        if (array_by_date[dt[0]] == undefined) array_by_date[dt[0]] = 1;\n        else array_by_date[dt[0]]++;\n\n        if (!item[4] || item[4] == '') comment[0]++;\n        else comment[1]++;\n\n        if (item[2] == \"新手\") byRole.begin[Number(item[3]) - 1]++;\n        if (item[2] == \"老手\") byRole.pro[Number(item[3]) - 1]++;\n\n    });\n\n    for (var i in array_by_date) {\n        categories.push(i);\n        series.push(array_by_date[i]);\n    }\n    // cons\n    Highcharts.chart('date-chart-container', {\n        title: {\n            text: 'Flowing by date'\n        },\n        chart: {\n            type: 'line'\n        },\n        xAxis: {\n            categories: categories,\n            labels: {\n                formatter() {\n                    return this.value.replace(/-/g, '/');\n                }\n            }\n        },\n        yAxis: {\n            title: {\n                text: 'Number of like'\n            }\n        },\n        legend: {\n            enabled: false\n        },\n        credits: {\n            enabled: false\n        },\n        plotOptions: {\n            line: {\n                dataLabels: {\n                    enabled: true\n                },\n                enableMouseTracking: false\n            }\n        },\n        series: [{\n            name: \"flow\",\n            data: series\n        }]\n    });\n\n    renderCommentChart(comment);\n    renderLikeChart(byRole);\n}\n\n\nfunction renderLikeChart(ary) {\n    var total = {\n            begin: 0,\n            pro: 0\n        },\n        score = {\n            begin: 0,\n            pro: 0\n        };\n\n    for (var i = 0; i < ary.begin.length; i++) {\n        total.begin += ary.begin[i];\n        score.begin += ary.begin[i] * (i + 1);\n    }\n    for (var i = 0; i < ary.pro.length; i++) {\n        total.pro += ary.pro[i];\n        score.pro += ary.pro[i] * (i + 1);\n    };\n\n    document.querySelector(\"#begin-score\").innerHTML = (score.begin / total.begin).toFixed(1);\n    document.querySelector(\"#pro-score\").innerHTML = (score.pro / total.pro).toFixed(1);\n\n    Highcharts.chart('like-chart-container', {\n        chart: {\n            type: 'column'\n        },\n        title: {\n            text: 'Role Average like'\n        },\n        xAxis: {\n            categories: ['不喜歡', '沒感覺', '還可以', '喜歡'],\n            crosshair: true\n        },\n        yAxis: {\n            min: 0,\n            title: {\n                text: 'Like numbers'\n            }\n        },\n        legend: {\n            enabled: false\n        },\n        credits: {\n            enabled: false\n        },\n        plotOptions: {\n            column: {\n                pointPadding: 0.2,\n                borderWidth: 0\n            }\n        },\n        series: [{\n            name: '新手',\n            data: ary.begin\n\n        }, {\n            name: '老手',\n            data: ary.pro\n\n        }]\n    });\n}\n\nfunction renderCommentChart(comment) {\n    Highcharts.chart('comment-chart-container', {\n        chart: {\n            plotBackgroundColor: null,\n            plotBorderWidth: null,\n            plotShadow: false,\n            type: 'pie'\n        },\n        title: {\n            text: 'Comment or not'\n        },\n        tooltip: {\n            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'\n        },\n        credits: {\n            enabled: false\n        },\n        series: [{\n            colorByPoint: true,\n            data: [{\n                name: 'No comment',\n                y: comment[0]\n            }, {\n                name: 'Comment',\n                y: comment[1]\n            }]\n        }]\n    });\n}"],"file":"tax-chart.js"}